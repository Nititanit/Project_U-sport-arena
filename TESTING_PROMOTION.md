# ЁЯзк р╕Чр╕Фр╕кр╕нр╕Ър╕гр╕░р╕Ър╕Ър╣Вр╕Ыр╕гр╣Вр╕бр╕Кр╕▒р╣Ир╕Щ

## тЪая╕П р╕Вр╣Йр╕нр╕Бр╕│р╕лр╕Щр╕Фр╕Бр╣Ир╕нр╕Щр╕Чр╕Фр╕кр╕нр╕Ъ

**р╕Хр╣Йр╕нр╕Зр╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓р╕Рр╕▓р╕Щр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Бр╣Ир╕нр╕Щ:**
1. р╕кр╕гр╣Йр╕▓р╕Зр╕Хр╕▓р╕гр╕▓р╕З `promotions` р╣Гр╕Щ Supabase р╕Хр╕▓р╕б SQL р╣Гр╕Щ `supabase_migration.sql`
2. р╕лр╕гр╕╖р╕нр╕Фр╕╣р╕Др╕│р╣Бр╕Щр╕░р╕Щр╕│р╣Гр╕Щ `QUICK_START.md` р╣Бр╕ер╕░ `PROMOTION_SYSTEM.md`

**р╕гр╕░р╕Ър╕Ър╕Ир╕░р╕Чр╕│р╕Зр╕▓р╕Щр╣Гр╕Щ 2 р╣Вр╕лр╕бр╕Ф:**
- тЬЕ **Database Mode**: Query р╕Ир╕▓р╕Б Supabase р╕Ир╕гр╕┤р╕З
- ЁЯФД **Fallback Mode**: р╕Цр╣Йр╕▓ DB р╣Др╕бр╣Ир╕Юр╕гр╣Йр╕нр╕б р╕Ир╕░р╣Гр╕Кр╣Й mock data

## р╕Вр╕▒р╣Йр╕Щр╕Хр╕нр╕Щр╕Бр╕▓р╕гр╕Чр╕Фр╕кр╕нр╕Ъ

### 1. р╣Гр╕кр╣Ир╕гр╕лр╕▒р╕кр╕кр╣Ир╕зр╕Щр╕ер╕Ф (User Side)

1. р╣Ар╕Ыр╕┤р╕Ф http://localhost:3000/reservation
2. р╣Ар╕ер╕╖р╕нр╕Бр╣Ар╕зр╕ер╕▓р╕Ир╕нр╕Зр╕нр╕вр╣Ир╕▓р╕Зр╕Щр╣Йр╕нр╕в 1-2 р╕Кр╣Ир╕зр╕З
3. р╣Гр╕Щр╕кр╣Ир╕зр╕Щ "р╕бр╕╡р╕гр╕лр╕▒р╕кр╕кр╣Ир╕зр╕Щр╕ер╕Ф?" р╣Гр╕лр╣Йр╣Гр╕кр╣Ир╣Вр╕Др╣Йр╕Фр╣Гр╕Ф р╣Ж р╕Хр╣Ир╕нр╣Др╕Ыр╕Щр╕╡р╣Й:

| р╕гр╕лр╕▒р╕к | р╕Ыр╕гр╕░р╣Ар╕ар╕Ч | р╕кр╣Ир╕зр╕Щр╕ер╕Ф | р╕лр╕бр╕▓р╕вр╣Ар╕лр╕Хр╕╕ |
|------|--------|--------|---------|
| SUMMER200 | р╕Ир╕│р╕Щр╕зр╕Щр╕Др╕Зр╕Чр╕╡р╣И | 200 р╕Ър╕▓р╕Ч | тЬЕ р╣Гр╕Кр╣Йр╣Др╕Фр╣Й |
| WELCOME20 | р╕гр╣Йр╕нр╕вр╕ер╕░ | 20% | тЬЕ р╣Гр╕Кр╣Йр╣Др╕Фр╣Й |
| VIPUSER500 | р╕Ир╕│р╕Щр╕зр╕Щр╕Др╕Зр╕Чр╕╡р╣И | 500 р╕Ър╕▓р╕Ч | тЬЕ р╣Гр╕Кр╣Йр╣Др╕Фр╣Й |
| INVALID | тЭМ р╣Др╕бр╣Ир╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕З | - | тЭМ р╣Бр╕кр╕Фр╕З error |
| EXPIRED2024 | тЭМ р╕лр╕бр╕Фр╕нр╕▓р╕вр╕╕ | - | тЭМ р╣Бр╕кр╕Фр╕З error |

### 2. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Бр╕▓р╕гр╣Бр╕кр╕Фр╕Зр╕Ьр╕е

#### тЬЕ р╣Ар╕бр╕╖р╣Ир╕нр╣Гр╕кр╣Ир╕гр╕лр╕▒р╕кр╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕З:
```
р╕гр╕▓р╕Др╕▓р╕гр╕зр╕б:          2,000 р╕Ър╕▓р╕Ч
р╕кр╣Ир╕зр╕Щр╕ер╕Ф (р╕ер╕Ф 200р╕Ъ): -200 р╕Ър╕▓р╕Ч
р╕гр╕зр╕бр╕Чр╕▒р╣Йр╕Зр╕кр╕┤р╣Йр╕Щ:       1,800 р╕Ър╕▓р╕Ч тЬЕ (р╣Бр╕кр╕Фр╕Зр╣Ар╕Ыр╣Зр╕Щр╕кр╕╡р╣Ар╕Вр╕╡р╕вр╕з)
```

#### тЭМ р╣Ар╕бр╕╖р╣Ир╕нр╣Гр╕кр╣Ир╕гр╕лр╕▒р╕кр╕Ьр╕┤р╕Ф:
```
р╣Ар╕лр╣Зр╕Щ error message: "р╕гр╕лр╕▒р╕кр╕кр╣Ир╕зр╕Щр╕ер╕Фр╣Др╕бр╣Ир╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕З"
```

#### тЭМ р╣Ар╕бр╕╖р╣Ир╕нр╣Вр╕Ыр╕гр╣Вр╕бр╕Кр╕▒р╣Ир╕Щр╕лр╕бр╕Фр╕нр╕▓р╕вр╕╕:
```
р╣Ар╕лр╣Зр╕Щ error message: "р╣Вр╕Ыр╕гр╣Вр╕бр╕Кр╕▒р╣Ир╕Щр╕лр╕бр╕Фр╕нр╕▓р╕вр╕╕р╣Бр╕ер╣Йр╕з"
```

### 3. р╕Ыр╕╕р╣Ир╕бр╕ер╕Ър╣Вр╕Ыр╕гр╣Вр╕бр╕Кр╕▒р╣Ир╕Щ
- р╣Ар╕бр╕╖р╣Ир╕нр╣Гр╕Кр╣Йр╣Вр╕Ыр╕гр╣Вр╕бр╕Кр╕▒р╣Ир╕Щр╕кр╕│р╣Ар╕гр╣Зр╕И р╕Ир╕░р╣Ар╕лр╣Зр╕Щр╕Ыр╕╕р╣Ир╕б "р╕ер╕Ъ"
- р╕Бр╕Фр╕Ыр╕╕р╣Ир╕б "р╕ер╕Ъ" р╣Ар╕Юр╕╖р╣Ир╕нр╕вр╕Бр╣Ар╕ер╕┤р╕Бр╕Бр╕▓р╕гр╣Гр╕Кр╣Й
- р╕гр╕▓р╕Др╕▓р╕Ир╕░р╕Бр╕ер╕▒р╕Ър╣Ар╕Ыр╣Зр╕Щр╕гр╕▓р╕Др╕▓р╣Ар╕Фр╕┤р╕б

### 4. р╕Чр╕Фр╕кр╕нр╕Ър╕Ир╕нр╕Зр╕кр╕Щр╕▓р╕б
- р╣Ар╕ер╕╖р╕нр╕Бр╣Ар╕зр╕ер╕▓ 2 р╕Кр╣Ир╕зр╕З (р╕гр╕░р╕лр╕зр╣Ир╕▓р╕З 13:00-15:00)
- р╣Гр╕кр╣Ир╕гр╕лр╕▒р╕к "SUMMER200"
- р╕Бр╕Фр╕Ыр╕╕р╣Ир╕б "р╕вр╕╖р╕Щр╕вр╕▒р╕Щр╕Бр╕▓р╕гр╕Ир╕нр╕З"
- р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ:
  - тЬЕ р╣Бр╕кр╕Фр╕З alert "р╕Ир╕нр╕Зр╕кр╕Щр╕▓р╕бр╕кр╕│р╣Ар╕гр╣Зр╕И!"
  - тЬЕ Promotion ID р╕Цр╕╣р╕Бр╕Ър╕▒р╕Щр╕Чр╕╢р╕Б (check console р╕лр╕гр╕╖р╕н Supabase)
  - тЬЕ р╕гр╕▓р╕Др╕▓р╕кр╕╕р╕Фр╕Чр╣Йр╕▓р╕в = 2,000 - 200 = 1,800 р╕Ър╕▓р╕Ч

---

## р╕Чр╕Фр╕кр╕нр╕Ър╕лр╕Щр╣Йр╕▓ Admin

### 1. р╣Др╕Ыр╕Чр╕╡р╣Ир╕лр╕Щр╣Йр╕▓ Admin
```
URL: http://localhost:3000/admin/promotions
```

### 2. р╕Фр╕╣р╕гр╕▓р╕вр╕Бр╕▓р╕гр╣Вр╕Ыр╕гр╣Вр╕бр╕Кр╕▒р╣Ир╕Щ
- тЬЕ р╣Бр╕кр╕Фр╕З 4 р╣Вр╕Ыр╕гр╣Вр╕бр╕Кр╕▒р╣Ир╕Щ (SUMMER200, WELCOME20, VIPUSER500, EXPIRED2024)
- тЬЕ EXPIRED2024 р╣Бр╕кр╕Фр╕З badge "тЭМ р╣Вр╕Ыр╕гр╣Вр╕бр╕Кр╕▒р╣Ир╕Щр╕лр╕бр╕Фр╕нр╕▓р╕вр╕╕"
- тЬЕ р╕нр╕╖р╣Ир╕Щ р╣Ж р╣Бр╕кр╕Фр╕З badge "тЬЕ р╣Вр╕Ыр╕гр╣Вр╕бр╕Кр╕▒р╣Ир╕Щр╕вр╕▒р╕Зр╕Др╕Зр╣Гр╕Кр╣Йр╣Др╕Фр╣Й"

### 3. р╕кр╕гр╣Йр╕▓р╕Зр╣Вр╕Ыр╕гр╣Вр╕бр╕Кр╕▒р╣Ир╕Щр╣Гр╕лр╕бр╣И
1. р╕Бр╕Фр╕Ыр╕╕р╣Ир╕б "+ р╣Ар╕Юр╕┤р╣Ир╕бр╣Вр╕Ыр╕гр╣Вр╕бр╕Кр╕▒р╣Ир╕Щр╣Гр╕лр╕бр╣И"
2. р╕Бр╕гр╕нр╕Бр╕Вр╣Йр╕нр╕бр╕╣р╕е:
   - р╕гр╕лр╕▒р╕Ф: `NEWYEAR2025`
   - р╕Др╕│р╕нр╕Шр╕┤р╕Ър╕▓р╕в: `р╕кр╣Ир╕зр╕Щр╕ер╕Фр╕кр╕│р╕лр╕гр╕▒р╕Ър╕Ыр╕╡р╣Гр╕лр╕бр╣И`
   - р╕Ыр╕гр╕░р╣Ар╕ар╕Ч: `р╕Ир╕│р╕Щр╕зр╕Щр╣Ар╕Зр╕┤р╕Щр╕Др╕Зр╕Чр╕╡р╣И`
   - р╕кр╣Ир╕зр╕Щр╕ер╕Ф: `300`
   - р╕зр╕▒р╕Щр╣Ар╕гр╕┤р╣Ир╕б: `2025-01-01`
   - р╕зр╕▒р╕Щр╕кр╕┤р╣Йр╕Щ: `2025-12-31`
   - р╕кр╕Цр╕▓р╕Щр╕░: `р╣Ар╕Ыр╕┤р╕Фр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щ`
3. р╕Бр╕Фр╕Ыр╕╕р╣Ир╕б "р╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╣Вр╕Ыр╕гр╣Вр╕бр╕Кр╕▒р╣Ир╕Щ"
4. тЬЕ р╕Хр╣Йр╕нр╕Зр╣Ар╕лр╣Зр╕Щ alert: "р╣Ар╕Юр╕┤р╣Ир╕бр╣Вр╕Ыр╕гр╣Вр╕бр╕Кр╕▒р╣Ир╕Щр╕кр╕│р╣Ар╕гр╣Зр╕И!"
5. тЬЕ р╕Хр╣Йр╕нр╕Зр╣Ар╕лр╣Зр╕Щр╕Бр╕▓р╕гр╣Мр╕Фр╣Гр╕лр╕бр╣Ир╣Ар╕Юр╕┤р╣Ир╕бр╣Ар╕Вр╣Йр╕▓р╕бр╕▓

### 4. р╕Ыр╕┤р╕Фр╣Вр╕Ыр╕гр╣Вр╕бр╕Кр╕▒р╣Ир╕Щ
1. р╕Бр╕Фр╕Ыр╕╕р╣Ир╕б "р╕Ыр╕┤р╕Фр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щ" р╕Ър╕Щр╕Бр╕▓р╕гр╣Мр╕Ф SUMMER200
2. тЬЕ Status р╣Ар╕Ыр╕ер╕╡р╣Ир╕вр╕Щр╣Ар╕Ыр╣Зр╕Щ "р╕Ыр╕┤р╕Ф"
3. тЬЕ р╕Ыр╕╕р╣Ир╕бр╣Ар╕Ыр╕ер╕╡р╣Ир╕вр╕Щр╣Ар╕Ыр╣Зр╕Щ "р╣Ар╕Ыр╕┤р╕Фр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щ"

### 5. р╕ер╕Ър╣Вр╕Ыр╕гр╣Вр╕бр╕Кр╕▒р╣Ир╕Щ
1. р╕Бр╕Фр╕Ыр╕╕р╣Ир╕б "р╕ер╕Ъ" р╕Ър╕Щр╕Бр╕▓р╕гр╣Мр╕Ф EXPIRED2024
2. тЬЕ р╣Ар╕лр╣Зр╕Щ confirm dialog: "р╕Хр╣Йр╕нр╕Зр╕Бр╕▓р╕гр╕ер╕Ър╣Вр╕Ыр╕гр╣Вр╕бр╕Кр╕▒р╣Ир╕Щр╕Щр╕╡р╣Йр╕лр╕гр╕╖р╕нр╣Др╕бр╣И?"
3. тЬЕ р╕лр╕ер╕▒р╕Зр╕Ир╕▓р╕Бр╕ер╕Ъ р╣Ар╕лр╣Зр╕Щ alert: "р╕ер╕Ър╣Вр╕Ыр╕гр╣Вр╕бр╕Кр╕▒р╣Ир╕Щр╕кр╕│р╣Ар╕гр╣Зр╕И!"
4. тЬЕ р╕Бр╕▓р╕гр╣Мр╕Фр╕лр╕▓р╕вр╣Др╕Ы

---

## Test Cases - Edge Cases

### Test 1: р╕кр╣Ир╕зр╕Щр╕ер╕Фр╣Ар╕Бр╕┤р╕Щр╕гр╕▓р╕Др╕▓
```
р╕кр╕Цр╕▓р╕Щр╕Бр╕▓р╕гр╕Ур╣М: р╕гр╕▓р╕Др╕▓р╕гр╕зр╕б 100 р╕Ър╕▓р╕Ч + р╕кр╣Ир╕зр╕Щр╕ер╕Ф 500 р╕Ър╕▓р╕Ч
р╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣М: р╕гр╕▓р╕Др╕▓р╕кр╕╕р╕Фр╕Чр╣Йр╕▓р╕в = 0 р╕Ър╕▓р╕Ч (р╣Др╕бр╣Ир╕Хр╕┤р╕Фр╕ер╕Ъ)
р╕Хр╕│р╣Бр╕лр╕Щр╣Ир╕З: lib/promotions.ts - calculateDiscount()
```

### Test 2: р╣Гр╕кр╣Ир╕гр╕лр╕▒р╕кр╕Лр╣Йр╕│р╕лр╕ер╕▓р╕вр╕Др╕гр╕▒р╣Йр╕З
```
р╕кр╕Цр╕▓р╕Щр╕Бр╕▓р╕гр╕Ур╣М: р╣Гр╕кр╣И SUMMER200 тЖТ р╕ер╕Ъ тЖТ р╣Гр╕кр╣И WELCOME20
р╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣М: тЬЕ р╕Др╕зр╕гр╕Чр╕│р╕Зр╕▓р╕Щ 100%
```

### Test 3: р╣Ар╕Ыр╕ер╕╡р╣Ир╕вр╕Щр╣Ар╕зр╕ер╕▓р╕лр╕ер╕▒р╕Зр╣Гр╕Кр╣Йр╣Вр╕Ыр╕гр╣Вр╕бр╕Кр╕▒р╣Ир╕Щ
```
р╕кр╕Цр╕▓р╕Щр╕Бр╕▓р╕гр╕Ур╣М: р╣Гр╕кр╣И SUMMER200 (2,000 р╕Ър╕▓р╕Ч) тЖТ р╣Ар╕ер╕╖р╕нр╕Бр╣Ар╕Юр╕┤р╣Ир╕бр╣Ар╕зр╕ер╕▓ (4,000 р╕Ър╕▓р╕Ч)
р╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣М: р╕кр╣Ир╕зр╕Щр╕ер╕Ф 200 р╕Ър╕▓р╕Ч, р╕гр╕▓р╕Др╕▓р╕кр╕╕р╕Фр╕Чр╣Йр╕▓р╕в 3,800 р╕Ър╕▓р╕Ч тЬЕ
```

### Test 4: р╣Вр╕Ыр╕гр╣Вр╕бр╕Кр╕▒р╣Ир╕Щ 20% р╕лр╕ер╕▓р╕вр╕гр╕▓р╕Др╕▓
```
р╕гр╕▓р╕Др╕▓ 1,000 р╕Ър╕▓р╕Ч + 20% = 800 р╕Ър╕▓р╕Ч тЬЕ
р╕гр╕▓р╕Др╕▓ 2,500 р╕Ър╕▓р╕Ч + 20% = 2,000 р╕Ър╕▓р╕Ч тЬЕ
р╕гр╕▓р╕Др╕▓ 1,500 р╕Ър╕▓р╕Ч + 20% = 1,200 р╕Ър╕▓р╕Ч тЬЕ
```

---

## Browser Console Testing

### р╕Чр╕Фр╕кр╕нр╕Ъ calculateDiscount()
```javascript
// Import р╣Др╕Фр╣Йр╕Ир╕▓р╕Б console
import { calculateDiscount, mockPromotions } from '@/lib/promotions'

// Test 1: р╕кр╣Ир╕зр╕Щр╕ер╕Ф 200 р╕Ър╕▓р╕Ч
const promo1 = mockPromotions[0] // SUMMER200
console.log(calculateDiscount(1000, promo1)) // р╕Хр╣Йр╕нр╕Зр╣Бр╕кр╕Фр╕З 200

// Test 2: р╕кр╣Ир╕зр╕Щр╕ер╕Ф 20%
const promo2 = mockPromotions[1] // WELCOME20
console.log(calculateDiscount(1000, promo2)) // р╕Хр╣Йр╕нр╕Зр╣Бр╕кр╕Фр╕З 200

// Test 3: р╣Ар╕Бр╕┤р╕Щр╕гр╕▓р╕Др╕▓
console.log(calculateDiscount(100, { ...promo1, discount_amount: 500 })) // р╕Хр╣Йр╕нр╕Зр╣Бр╕кр╕Фр╕З 100
```

---

## Mock Data Summary

```typescript
mockPromotions = [
  { id: 'promo-001', name: 'SUMMER200', discount_amount: 200, valid: true },
  { id: 'promo-002', name: 'WELCOME20', discount_percentage: 20, valid: true },
  { id: 'promo-003', name: 'VIPUSER500', discount_amount: 500, valid: true },
  { id: 'promo-004', name: 'EXPIRED2024', discount_amount: 300, valid: false }, // р╕лр╕бр╕Фр╕нр╕▓р╕вр╕╕
]
```

---

## тЬЕ Checklist р╕Бр╣Ир╕нр╕Щр╕Юр╕▒р╕Тр╕Щр╕▓р╕Хр╣Ир╕н

- [ ] р╕Чр╕╕р╕Бр╕гр╕лр╕▒р╕кр╕Щр╕▒р╣Йр╕Щр╕Чр╕│р╕Зр╕▓р╕Щ
- [ ] Error message р╣Бр╕кр╕Фр╕Зр╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕З
- [ ] р╕гр╕▓р╕Др╕▓р╕Др╕│р╕Щр╕зр╕Ур╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕З
- [ ] Promotion р╕Цр╕╣р╕Бр╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╣Гр╕Щ booking
- [ ] Admin page р╣Гр╕Кр╣Йр╣Др╕Фр╣Йр╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф
- [ ] Mobile responsive р╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф

---

## р╕кр╕┤р╣Ир╕Зр╕Чр╕╡р╣Ир╕Хр╣Йр╕нр╕Зр╣Ар╕Хр╕гр╕╡р╕вр╕бр╕кр╕│р╕лр╕гр╕▒р╕Ъ Production

1. тЬЕ р╣Ар╕Кр╕╖р╣Ир╕нр╕бр╕Хр╣Ир╕н Supabase (р╣Бр╕Чр╕Щ mock data)
2. тЬЕ р╣Ар╕Юр╕┤р╣Ир╕б Authentication р╕кр╕│р╕лр╕гр╕▒р╕Ъ Admin
3. тЬЕ р╕кр╕гр╣Йр╕▓р╕З SQL Schema р╕кр╕│р╕лр╕гр╕▒р╕Ъ promotions table
4. тЬЕ р╣Ар╕Юр╕┤р╣Ир╕б Error Handling р╣Бр╕ер╕░ Loading States
5. тЬЕ Unit Tests р╕кр╕│р╕лр╕гр╕▒р╕Ъ promotion functions
6. тЬЕ API Rate Limiting р╕кр╕│р╕лр╕гр╕▒р╕Ър╕Ыр╣Йр╕нр╕Зр╕Бр╕▒р╕Щ Brute Force
